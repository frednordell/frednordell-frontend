on:
    push:
        branches:
            - main

permissions:
      contents: read
      deployments: write
jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Build and Test 
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install bun
        uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install && bun playwright install webkit --with-deps
      - name: Run tests
        run: bun run test --no-watch
      - name: Build app
        run: bun run build
      # - name: Create release
      # env:
      #   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   tag: ${{ github.ref_name }}
      # run: |
      #   gh release create "$tag" \
      #       --repo="$GITHUB_REPOSITORY" \
      #       --title="${GITHUB_REPOSITORY#*/} ${tag#v}" \
      #       --generate-notes
    #   - name: Publish
    #     uses: cloudflare/pages-action@v1
    #     with:
    #       apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
    #       accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
    #       projectName: frednordell.com 
    #       directory: dist 
    #       gitHubToken: ${{ secrets.GITHUB_TOKEN }}
